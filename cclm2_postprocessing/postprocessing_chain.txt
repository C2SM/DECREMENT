# Stuff to do for each experiment

cases="cclm2_EUR11_FB_nac cclm2_EUR11_FB_nfn cclm2_EUR11_FB_nfs cclm2_EUR11_FB_ssp1"

#-----------------------------
# POSTPROCESSING
#-----------------------------

for case in $cases; do
    # Copy the postprocessing scripts to scratch
    cd $PROJECT/decrement
    cp -r cclm2_postprocessing $SCRATCH/${case}

    # Submit the postprocessing jobs
    cd $SCRATCH/${case}/cclm2_postprocessing
    sbatch spinup-stability_CLM.sh
    sbatch postprocess_CLM.sh
    sbatch postprocess_COSMO.sh
done

# When all postprocessing is done, sumit the xfer jobs
for case in $cases; do
    cd $SCRATCH/${case}/cclm2_postprocessing
    sbatch postprocess_xfer.sh
done


#-----------------------------
# ARCHIVING
#-----------------------------

for case in $cases; do
    # Copy user settings and scripts to scratch
    mv $SCRATCH/${case}/user_settings $SCRATCH/${case}/user_settings_future
    cp $PROJECT/decrement/user_settings_archiving $SCRATCH/${case}/user_settings
    cp $PROJECT/decrement/tools.sh $SCRATCH/${case}/
    rsync -av $PROJECT/decrement/50_pack_data $SCRATCH/${case}/

    # Run (submits the jobs chained)
    cd $SCRATCH/${case}
    bash run_daint.sh
done

# When all compressing/packing is done, sumit the xfer jobs
for case in $cases; do
    cp $PROJECT/decrement/cclm2_postprocessing/archive_xfer.sh $SCRATCH/${case}/cclm2_postprocessing/.
    cd $PROJECT/decrement/cclm2_postprocessing
    sbatch archive_xfer.sh
done





